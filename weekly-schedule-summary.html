<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ¯é€±è¡Œç¨‹ç¸½è¦½ - å°ˆæ¥­ç®¡ç†ç³»çµ±</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0; 
      padding: 0;
      min-height: 100vh;
      transition: all 0.3s ease;
    }
    
    body.dark {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    }
    
    .theme-toggle {
      position: fixed; 
      top: 20px; 
      right: 30px; 
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      padding: 12px 20px;
      font-size: 0.9em;
      color: #357abd;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    
    .theme-toggle.dark {
      background: rgba(45, 50, 58, 0.95);
      color: #ffe082;
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .nav-bar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 15px 0;
      text-align: center;
      font-size: 1.1em;
      letter-spacing: 1px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    body.dark .nav-bar {
      background: rgba(45, 50, 58, 0.95);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .nav-link {
      color: #357abd;
      text-decoration: none;
      font-weight: 600;
      padding: 12px 28px;
      border-radius: 24px;
      font-size: 1.1em;
      transition: all 0.3s ease;
      margin: 0 12px;
      position: relative;
      overflow: hidden;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(53,122,189,0.04);
    }
    
    .nav-link:active {
      transform: scale(0.97);
    }
    
    .nav-link:hover {
      background: rgba(53, 122, 189, 0.18);
      color: #1a4e7a;
      box-shadow: 0 4px 16px rgba(53,122,189,0.10);
    }
    
    .nav-link.active {
      background: #ffe082;
      color: #2d323a;
      font-weight: 800;
      box-shadow: 0 4px 20px rgba(255,224,130,0.18);
      border: 2px solid #ffd54f;
    }
    
    body.dark .nav-link {
      color: #ffe082;
    }
    
    body.dark .nav-link:hover {
      background: rgba(255, 224, 130, 0.1);
    }
    
    body.dark .nav-link.active {
      background: #ffe082;
      color: #2d323a;
    }
    
    .container {
      max-width: 1600px;
      width: 95vw;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .header-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      padding: 40px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    body.dark .header-section {
      background: rgba(45, 50, 58, 0.95);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .title {
      font-size: 2.2em;
      font-weight: 800;
      background: linear-gradient(135deg, #357abd, #4a90e2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 25px;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 15px;
      text-align: center;
      justify-content: center;
    }
    
    body.dark .title {
      background: linear-gradient(135deg, #ffe082, #ffd54f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .title .icon {
      font-size: 1.2em;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }
    
    .controls-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .week-select-group {
      display: flex;
      align-items: center;
      gap: 15px;
      background: rgba(255, 255, 255, 0.8);
      padding: 15px 25px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    body.dark .week-select-group {
      background: rgba(45, 50, 58, 0.8);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .week-label {
      font-size: 1.1em;
      color: #2d3e50;
      font-weight: 600;
    }
    
    body.dark .week-label {
      color: #eee;
    }
    
    .week-select {
      font-size: 1em;
      padding: 10px 20px;
      border-radius: 10px;
      border: 2px solid #e3e8f0;
      background: white;
      color: #2d3e50;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 200px;
    }
    
    .week-select:focus {
      outline: none;
      border-color: #357abd;
      box-shadow: 0 0 0 3px rgba(53, 122, 189, 0.1);
    }
    
    body.dark .week-select {
      background: #2d323a;
      color: #eee;
      border-color: #444;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
    }
    
    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #357abd, #4a90e2);
      color: white;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6c757d, #868e96);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }
    
    .pro-summary-employee {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      margin-bottom: 40px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      animation: slideInUp 0.6s ease-out;
    }
    
    .pro-summary-employee:hover {
      transform: translateY(-5px);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
    }
    
    body.dark .pro-summary-employee {
      background: rgba(45, 50, 58, 0.95);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .pro-summary-title {
      font-size: 1.5em;
      font-weight: 700;
      background: linear-gradient(135deg, #357abd, #4a90e2);
      color: white;
      padding: 25px 35px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
      overflow: hidden;
    }
    
    .pro-summary-title::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.8s;
    }
    
    .pro-summary-employee:hover .pro-summary-title::before {
      left: 100%;
    }
    
    body.dark .pro-summary-title {
      background: linear-gradient(135deg, #2d323a, #3a4149);
    }
    
    .pro-summary-title .icon {
      font-size: 1.3em;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }
    
    .pro-summary-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin: 0;
      background: rgba(249, 251, 253, 0.8);
      overflow: hidden;
    }
    
    body.dark .pro-summary-table {
      background: rgba(35, 39, 46, 0.8);
    }
    
    .pro-summary-table th,
    .pro-summary-table td {
      border: 1px solid rgba(227, 232, 240, 0.8);
      padding: 20px 15px;
      text-align: left;
      font-size: 1.1em;
      vertical-align: top;
      transition: all 0.3s ease;
    }
    
    body.dark .pro-summary-table th,
    body.dark .pro-summary-table td {
      border-color: rgba(68, 68, 68, 0.8);
    }
    
    .pro-summary-table th {
      background: linear-gradient(135deg, #eaf3fb, #f8fbff);
      color: #357abd;
      font-weight: 700;
      text-align: center;
      font-size: 1.2em;
      letter-spacing: 1px;
      padding: 20px 15px;
      position: relative;
    }
    
    body.dark .pro-summary-table th {
      background: linear-gradient(135deg, #2d323a, #3a4149);
      color: #ffe082;
    }
    
    .pro-summary-table tr:hover td {
      background: rgba(240, 247, 255, 0.9);
    }
    
    body.dark .pro-summary-table tr:hover td {
      background: rgba(45, 50, 58, 0.9);
    }
    
    .pro-summary-daycell {
      min-width: 250px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 0 0 16px 16px;
      padding: 25px 20px;
      font-size: 1.1em;
      position: relative;
      overflow: hidden;
    }
    
    .pro-summary-daycell::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #357abd, #4a90e2);
    }
    
    body.dark .pro-summary-daycell {
      background: rgba(45, 50, 58, 0.9);
    }
    
    body.dark .pro-summary-daycell::before {
      background: linear-gradient(90deg, #ffe082, #ffd54f);
    }
    
    .pro-summary-routes {
      margin-bottom: 20px;
    }
    
    .pro-summary-route {
      margin-bottom: 12px;
      padding: 15px;
      border-left: 5px solid #4a90e2;
      background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
      border-radius: 0 12px 12px 0;
      font-size: 1.1em;
      color: #2d3e50;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      line-height: 1.8;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .pro-summary-route::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(74, 144, 226, 0.05), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .pro-summary-route:hover::before {
      opacity: 1;
    }
    
    body.dark .pro-summary-route {
      background: linear-gradient(135deg, rgba(255, 224, 130, 0.1), rgba(255, 224, 130, 0.05));
      border-left-color: #ffe082;
      color: #eee;
    }
    
    .pro-summary-route b {
      font-weight: 700;
      color: #357abd;
      margin-right: 8px;
      display: inline-block;
      min-width: 60px;
    }
    
    body.dark .pro-summary-route b {
      color: #ffe082;
    }
    
    .pro-summary-meta {
      font-size: 1.05em;
      color: #666;
      margin-top: 20px;
      border-top: 2px dashed rgba(227, 232, 240, 0.8);
      padding-top: 15px;
      line-height: 2.2;
      background: rgba(249, 251, 253, 0.5);
      padding: 15px;
      border-radius: 12px;
    }
    
    body.dark .pro-summary-meta {
      color: #aaa;
      border-top-color: rgba(68, 68, 68, 0.8);
      background: rgba(35, 39, 46, 0.5);
    }
    
    .pro-summary-meta b {
      color: #357abd;
      font-weight: 700;
      margin-right: 8px;
      display: inline-block;
      min-width: 80px;
    }
    
    body.dark .pro-summary-meta b {
      color: #ffe082;
    }
    
    .pro-summary-refuel {
      color: #e67e22;
      font-weight: bold;
      font-size: 1.15em;
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, rgba(230, 126, 34, 0.1), rgba(230, 126, 34, 0.05));
      padding: 12px 15px;
      border-radius: 12px;
      border-left: 4px solid #e67e22;
    }
    
    body.dark .pro-summary-refuel {
      color: #ffb74d;
      background: linear-gradient(135deg, rgba(255, 183, 77, 0.1), rgba(255, 183, 77, 0.05));
      border-left-color: #ffb74d;
    }
    
    .pro-summary-refuel-detail {
      font-size: 1.05em;
      font-weight: normal;
      color: #e67e22;
      margin-left: 8px;
    }
    
    body.dark .pro-summary-refuel-detail {
      color: #ffb74d;
    }
    
    /* åŠ æ²¹æŒ‰éˆ•æ¨£å¼ */
    .pro-summary-refuel-section {
      margin-top: 15px;
    }
    
    .refuel-btn {
      background: linear-gradient(135deg, #e67e22, #f39c12);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.95em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(230, 126, 34, 0.3);
    }
    
    .refuel-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(230, 126, 34, 0.4);
    }
    
    .refuel-btn:active {
      transform: translateY(0);
    }
    
    body.dark .refuel-btn {
      background: linear-gradient(135deg, #ff9800, #ffb74d);
      box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
    }
    
    body.dark .refuel-btn:hover {
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
    }
    
    .empty-day {
      color: #bbb;
      font-size: 1em;
      font-style: italic;
      text-align: center;
      padding: 20px;
      background: rgba(249, 251, 253, 0.3);
      border-radius: 12px;
      border: 2px dashed rgba(227, 232, 240, 0.8);
    }
    
    body.dark .empty-day {
      color: #666;
      background: rgba(35, 39, 46, 0.3);
      border-color: rgba(68, 68, 68, 0.8);
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1200px) {
      .pro-summary-table th,
      .pro-summary-table td {
        font-size: 1em;
      }
      .pro-summary-daycell {
        min-width: 200px;
      }
    }
    
    @media (max-width: 900px) {
      .container {
        width: 98vw;
        padding: 0 10px;
      }
      
      .header-section {
        padding: 30px 20px;
      }
      
      .title {
        font-size: 1.8em;
      }
      
      .controls-section {
        flex-direction: column;
        align-items: stretch;
      }
      
      .week-select-group {
        justify-content: center;
      }
      
      .action-buttons {
        justify-content: center;
      }
      
      .pro-summary-table th,
      .pro-summary-table td {
        font-size: 0.95em;
      }
      
      .pro-summary-daycell {
        min-width: 180px;
        padding: 20px 15px;
      }
    }
    
    @media (max-width: 700px) {
      .pro-summary-title {
        font-size: 1.2em;
        padding: 20px 15px;
      }
      
      .pro-summary-table,
      .pro-summary-table thead,
      .pro-summary-table tbody,
      .pro-summary-table tr {
        display: block;
        width: 100%;
      }
      
      .pro-summary-table th {
        display: none;
      }
      
      .pro-summary-table td.pro-summary-daycell {
        display: block;
        min-width: unset;
        width: 95%;
        margin: 0 auto 25px auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        padding: 25px 20px;
        font-size: 1.05em;
        border: 1px solid rgba(227, 232, 240, 0.8);
      }
      
      body.dark .pro-summary-table td.pro-summary-daycell {
        background: rgba(45, 50, 58, 0.95);
        border-color: rgba(255, 255, 255, 0.1);
      }
      
      .pro-summary-table td:not(.pro-summary-daycell) {
        display: none;
      }
      
      .pro-summary-table tr {
        margin-bottom: 25px;
      }
      
      .pro-summary-employee {
        padding: 0 0 15px 0;
      }
      .nav-link {
        padding: 16px 0;
        font-size: 1.2em;
        display: block;
        margin: 0 0 8px 0;
        width: 100%;
        border-radius: 18px;
      }
      .nav-bar {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        z-index: 100;
      }
      .pro-summary-route > div {
        flex-wrap: wrap;
      }
      .photo-upload-btn {
        margin-top: 6px;
        margin-bottom: 6px;
      }
    }
    
    /* å…¬é‡Œæ•¸å½™æ•´æ¨¡æ…‹æ¡†æ¨£å¼ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      min-width: 400px;
      max-width: 95vw;
      max-height: 90vh;
      overflow: auto;
      border-radius: 20px;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
      padding: 40px 30px;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    body.dark .modal-content {
      background: rgba(45, 50, 58, 0.95);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.5em;
      background: none;
      border: none;
      cursor: pointer;
      color: #357abd;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      background: rgba(53, 122, 189, 0.1);
      transform: rotate(90deg);
    }
    
    body.dark .modal-close {
      color: #ffe082;
    }
    
    body.dark .modal-close:hover {
      background: rgba(255, 224, 130, 0.1);
    }
    
    .modal-title {
      font-size: 1.4em;
      font-weight: 700;
      color: #357abd;
      margin-bottom: 25px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: center;
      justify-content: center;
    }
    
    body.dark .modal-title {
      color: #ffe082;
    }
    
    .modal-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .modal-controls label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #2d3e50;
      margin-right: 20px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .modal-controls label:hover {
      background: rgba(53, 122, 189, 0.1);
    }
    
    body.dark .modal-controls label {
      color: #eee;
    }
    
    body.dark .modal-controls label:hover {
      background: rgba(255, 224, 130, 0.1);
    }
    
    .modal-controls input[type="date"] {
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid #e3e8f0;
      background: white;
      color: #2d3e50;
      font-weight: 500;
    }
    
    .modal-controls input[type="date"]:focus {
      outline: none;
      border-color: #357abd;
      box-shadow: 0 0 0 3px rgba(53, 122, 189, 0.1);
    }
    
    body.dark .modal-controls input[type="date"] {
      background: #2d323a;
      color: #eee;
      border-color: #444;
    }
    
    .modal-controls input[type="radio"] {
      margin-right: 8px;
      accent-color: #357abd;
    }
    
    body.dark .modal-controls input[type="radio"] {
      accent-color: #ffe082;
    }
    
    .modal-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95em;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    body.dark .modal-table {
      background: #2d323a;
    }
    
    .modal-table th {
      background: linear-gradient(135deg, #eaf3fb, #f8fbff);
      color: #357abd;
      font-weight: 700;
      padding: 12px 8px;
      text-align: center;
      border: 1px solid #e3e8f0;
    }
    
    body.dark .modal-table th {
      background: linear-gradient(135deg, #2d323a, #3a4149);
      color: #ffe082;
      border-color: #444;
    }
    
    .modal-table td {
      padding: 10px 8px;
      border: 1px solid #e3e8f0;
      text-align: center;
    }
    
    body.dark .modal-table td {
      border-color: #444;
      color: #eee;
    }
    
    .modal-table tr:nth-child(even) {
      background: rgba(249, 251, 253, 0.5);
    }
    
    body.dark .modal-table tr:nth-child(even) {
      background: rgba(35, 39, 46, 0.5);
    }
    
    .modal-table tr:hover {
      background: rgba(240, 247, 255, 0.8);
    }
    
    body.dark .modal-table tr:hover {
      background: rgba(45, 50, 58, 0.8);
    }
    
    .modal-actions {
      margin-top: 25px;
      text-align: center;
    }
    
    /* æ™ºèƒ½åˆ†æå„€è¡¨æ¿æ¨£å¼ */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 25px;
      margin: 25px 0;
    }
    
    .analytics-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .analytics-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    
    body.dark .analytics-card {
      background: rgba(45, 50, 58, 0.95);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .analytics-card h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #357abd;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    body.dark .analytics-card h3 {
      color: #ffe082;
    }
    
    .chart-container {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      color: #666;
    }
    
    body.dark .chart-container {
      color: #aaa;
    }
    
    .chart-container.loading {
      color: #357abd;
      font-weight: 600;
    }
    
    body.dark .chart-container.loading {
      color: #ffe082;
    }
    
    /* æ’è¡Œæ¦œæ¨£å¼ */
    .ranking-list {
      width: 100%;
    }
    
    .ranking-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: linear-gradient(135deg, rgba(53, 122, 189, 0.1), rgba(53, 122, 189, 0.05));
      border-radius: 12px;
      border-left: 4px solid #357abd;
      transition: all 0.3s ease;
    }
    
    .ranking-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 16px rgba(53, 122, 189, 0.2);
    }
    
    body.dark .ranking-item {
      background: linear-gradient(135deg, rgba(255, 224, 130, 0.1), rgba(255, 224, 130, 0.05));
      border-left-color: #ffe082;
    }
    
    .ranking-rank {
      font-size: 1.2em;
      font-weight: 800;
      color: #357abd;
      min-width: 30px;
    }
    
    body.dark .ranking-rank {
      color: #ffe082;
    }
    
    .ranking-info {
      flex: 1;
      margin-left: 15px;
    }
    
    .ranking-name {
      font-weight: 600;
      color: #2d3e50;
      margin-bottom: 4px;
    }
    
    body.dark .ranking-name {
      color: #eee;
    }
    
    .ranking-count {
      font-size: 0.9em;
      color: #666;
    }
    
    body.dark .ranking-count {
      color: #aaa;
    }
    
    .ranking-bar {
      width: 60px;
      height: 8px;
      background: #e3e8f0;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .ranking-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #357abd, #4a90e2);
      border-radius: 4px;
      transition: width 0.8s ease;
    }
    
    body.dark .ranking-bar {
      background: #444;
    }
    
    body.dark .ranking-bar-fill {
      background: linear-gradient(90deg, #ffe082, #ffd54f);
    }
    
    /* å·¥ä½œé‡åˆ†å¸ƒæ¨£å¼ */
    .workload-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      border: 1px solid rgba(227, 232, 240, 0.8);
      transition: all 0.3s ease;
    }
    
    .workload-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    
    body.dark .workload-item {
      background: rgba(45, 50, 58, 0.8);
      border-color: rgba(68, 68, 68, 0.8);
    }
    
    .workload-name {
      font-weight: 600;
      color: #2d3e50;
    }
    
    body.dark .workload-name {
      color: #eee;
    }
    
    .workload-stats {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .workload-stat {
      text-align: center;
    }
    
    .workload-number {
      font-size: 1.3em;
      font-weight: 700;
      color: #357abd;
    }
    
    body.dark .workload-number {
      color: #ffe082;
    }
    
    .workload-label {
      font-size: 0.8em;
      color: #666;
      margin-top: 4px;
    }
    
    body.dark .workload-label {
      color: #aaa;
    }
    
    /* ç†±åŠ›åœ–æ¨£å¼ */
    .heatmap-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin: 20px 0;
    }
    
    .heatmap-day {
      aspect-ratio: 1;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9em;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .heatmap-day:hover {
      transform: scale(1.1);
      z-index: 10;
    }
    
    .heatmap-day.low {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      color: #1976d2;
    }
    
    .heatmap-day.medium {
      background: linear-gradient(135deg, #fff3e0, #ffcc02);
      color: #f57c00;
    }
    
    .heatmap-day.high {
      background: linear-gradient(135deg, #ffebee, #ef5350);
      color: #d32f2f;
    }
    
    .heatmap-day.very-high {
      background: linear-gradient(135deg, #f3e5f5, #ab47bc);
      color: #7b1fa2;
    }
    
    body.dark .heatmap-day.low {
      background: linear-gradient(135deg, #1a237e, #3949ab);
      color: #c5cae9;
    }
    
    body.dark .heatmap-day.medium {
      background: linear-gradient(135deg, #e65100, #ff6f00);
      color: #ffcc02;
    }
    
    body.dark .heatmap-day.high {
      background: linear-gradient(135deg, #c62828, #d32f2f);
      color: #ffcdd2;
    }
    
    body.dark .heatmap-day.very-high {
      background: linear-gradient(135deg, #4a148c, #7b1fa2);
      color: #e1bee7;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1200px) {
      .analytics-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .analytics-card {
        padding: 20px;
      }
      
      .workload-stats {
        flex-direction: column;
        gap: 10px;
      }
      
      .heatmap-container {
        grid-template-columns: repeat(3, 1fr);
      }
      
      /* æ‰‹æ©Ÿç‰ˆæ¨¡æ…‹æ¡†å„ªåŒ– */
      .modal-content {
        min-width: 95vw;
        max-width: 95vw;
        padding: 20px 15px;
        margin: 10px;
        max-height: 85vh;
      }
      
      .modal-title {
        font-size: 1.2em;
        margin-bottom: 20px;
      }
      
      .modal-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      
      .modal-controls label {
        margin-right: 0;
        justify-content: center;
        padding: 12px;
        background: rgba(53, 122, 189, 0.1);
        border-radius: 8px;
      }
      
      .modal-table {
        font-size: 0.85em;
      }
      
      .modal-table th,
      .modal-table td {
        padding: 8px 4px;
        word-break: break-word;
      }
      
      /* æ‰‹æ©Ÿç‰ˆè¡¨æ ¼éŸ¿æ‡‰å¼è™•ç† */
      .modal-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch; /* iOSå¹³æ»‘æ»¾å‹• */
        scrollbar-width: thin; /* Firefox */
      }
      
      .modal-table::-webkit-scrollbar {
        height: 6px;
      }
      
      .modal-table::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.1);
        border-radius: 3px;
      }
      
      .modal-table::-webkit-scrollbar-thumb {
        background: rgba(53, 122, 189, 0.5);
        border-radius: 3px;
      }
      
      .modal-table table {
        min-width: 600px;
        border-collapse: collapse;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•å„ªåŒ– */
      .modal-actions .btn {
        width: 100%;
        margin-bottom: 10px;
        padding: 15px;
        font-size: 1.1em;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæ¯”ä¾‹å®¹å™¨å„ªåŒ– */
      .ratio-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .ratio-item {
        min-width: auto;
        width: 100%;
      }
      
      /* æ‰‹æ©Ÿç‰ˆè¶¨å‹¢æ¯”è¼ƒå„ªåŒ– */
      .trend-comparison {
        flex-direction: column;
        gap: 15px;
      }
      
      .trend-item {
        width: 100%;
      }
    }
    
    /* æ›´å°è¢å¹•çš„é¡å¤–å„ªåŒ– */
    @media (max-width: 480px) {
      .modal-content {
        min-width: 98vw;
        max-width: 98vw;
        padding: 15px 10px;
        margin: 5px;
      }
      
      .modal-title {
        font-size: 1.1em;
        flex-direction: column;
        gap: 8px;
      }
      
      .modal-controls input[type="date"] {
        font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
        padding: 12px;
      }
      
      .modal-table {
        font-size: 0.8em;
      }
      
      .modal-table th,
      .modal-table td {
        padding: 6px 3px;
        font-size: 0.75em;
      }
      
      /* æ‰‹æ©Ÿç‰ˆè¡¨æ ¼é€²ä¸€æ­¥å„ªåŒ– */
      .modal-table table {
        min-width: 500px;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•é€²ä¸€æ­¥å„ªåŒ– */
      .modal-actions .btn {
        padding: 18px;
        font-size: 1.2em;
        border-radius: 15px;
      }
      
      /* æ‰‹æ©Ÿç‰ˆé—œé–‰æŒ‰éˆ•å„ªåŒ– */
      .modal-close {
        top: 10px;
        right: 15px;
        width: 35px;
        height: 35px;
        font-size: 1.3em;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæ™ºèƒ½åˆ†æå¡ç‰‡å„ªåŒ– */
      .analytics-card {
        padding: 15px;
        margin-bottom: 15px;
      }
      
      .analytics-card h3 {
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæ’è¡Œæ¦œå„ªåŒ– */
      .ranking-item {
        padding: 10px 12px;
        margin-bottom: 6px;
      }
      
      .ranking-rank {
        font-size: 1.1em;
        min-width: 25px;
      }
      
      .ranking-name {
        font-size: 0.9em;
      }
      
      .ranking-count {
        font-size: 0.8em;
      }
      
      .category-tag {
        font-size: 0.7em;
        padding: 2px 8px;
      }
      
      /* æ‰‹æ©Ÿç‰ˆè§¸æ§å„ªåŒ– */
      .modal-controls label {
        min-height: 44px; /* iOSå»ºè­°çš„æœ€å°è§¸æ§å€åŸŸ */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .modal-controls input[type="radio"] {
        transform: scale(1.2); /* æ”¾å¤§å–®é¸æŒ‰éˆ• */
        margin-right: 12px;
      }
      
      /* æ‰‹æ©Ÿç‰ˆè¡¨æ ¼è§¸æ§å„ªåŒ– */
      .modal-table th,
      .modal-table td {
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•è§¸æ§å„ªåŒ– */
      .btn {
        min-height: 44px;
        touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
      }
      
      /* æ‰‹æ©Ÿç‰ˆæ¨¡æ…‹æ¡†è§¸æ§å„ªåŒ– */
      .modal-close {
        min-width: 44px;
        min-height: 44px;
        touch-action: manipulation;
      }
      
      /* æ‰‹æ©Ÿç‰ˆåŠ æ²¹æŒ‰éˆ•å„ªåŒ– */
      .refuel-btn {
        width: 100%;
        justify-content: center;
        padding: 12px;
        font-size: 1em;
      }
      
      /* æ‰‹æ©Ÿç‰ˆåŠ æ²¹çµ±è¨ˆå„ªåŒ– */
      #refuelStats {
        margin: 15px 0;
        padding: 12px;
      }
      
      #refuelStatsContent {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        font-size: 0.85em;
      }
    }
    
    body.dark .heatmap-day.very-high {
      background: linear-gradient(135deg, #4a148c, #7b1fa2);
      color: #e1bee7;
    }
    
    /* æ‹œè¨ªç¶­ä¿®åˆ†ææ¨£å¼ */
    .ratio-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      padding: 20px;
    }
    
    .ratio-item {
      text-align: center;
      padding: 20px;
      border-radius: 16px;
      min-width: 120px;
      position: relative;
      overflow: hidden;
    }
    
    .ratio-item.visit {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
    }
    
    .ratio-item.repair {
      background: linear-gradient(135deg, #ff9800, #ffb74d);
      color: white;
    }
    
    .ratio-number {
      font-size: 2.5em;
      font-weight: 800;
      margin-bottom: 8px;
    }
    
    .ratio-label {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .ratio-percentage {
      font-size: 0.9em;
      opacity: 0.9;
    }
    
    .category-tag {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .category-tag.visit {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
    }
    
    .category-tag.repair {
      background: linear-gradient(135deg, #ff9800, #ffb74d);
      color: white;
    }
    
    .trend-comparison {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .trend-item {
      flex: 1;
      text-align: center;
      padding: 15px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    body.dark .trend-item {
      background: rgba(45, 50, 58, 0.3);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .trend-title {
      font-size: 0.9em;
      font-weight: 600;
      margin-bottom: 10px;
      color: #666;
    }
    
    body.dark .trend-title {
      color: #aaa;
    }
    
    .trend-value {
      font-size: 1.5em;
      font-weight: 700;
      color: #357abd;
    }
    
    body.dark .trend-value {
      color: #ffe082;
    }
    
    .trend-change {
      font-size: 0.8em;
      margin-top: 5px;
    }
    
    .trend-change.positive {
      color: #4caf50;
    }
    
    .trend-change.negative {
      color: #f44336;
    }
    
    .trend-change.neutral {
      color: #666;
    }
    
    body.dark .trend-change.neutral {
      color: #aaa;
    }
    
    /* åœ¨ style å€å¡ŠåŠ ï¼š */
    .pro-summary-meta-table {
      width: auto;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 1.08em;
    }
    .pro-summary-meta-table td {
      padding: 4px 10px;
      border: none;
      vertical-align: middle;
    }
    .pro-summary-meta-table td:first-child {
      font-weight: 600;
      color: #357abd;
      min-width: 90px;
    }
    
    /* åˆ†éš”ç·šæ¨£å¼ */
    .meta-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(53, 122, 189, 0.3), transparent);
      margin: 12px 0;
      border-radius: 1px;
    }
    
    body.dark .meta-divider {
      background: linear-gradient(90deg, transparent, rgba(255, 224, 130, 0.3), transparent);
    }
    
    /* æ™‚é–“å’Œè»Šè¼›å€å¡Šæ¨£å¼ */
    .time-section,
    .vehicle-section {
      margin-bottom: 15px;
    }
    
    .time-header,
    .vehicle-header {
      font-size: 0.95em;
      font-weight: 700;
      color: #357abd;
      margin-bottom: 8px;
      padding: 6px 0;
      border-bottom: 2px solid rgba(53, 122, 189, 0.2);
      border-radius: 0 0 4px 4px;
    }
    
    body.dark .time-header,
    body.dark .vehicle-header {
      color: #ffe082;
      border-bottom-color: rgba(255, 224, 130, 0.2);
    }
  </style>
  <script>
    function getMonday(d) { d = new Date(d); var day = d.getDay(), diff = d.getDate() - day + (day === 0 ? -6 : 1); return new Date(d.setDate(diff)); }
    function formatDate(date) { return date.toISOString().slice(0,10); }
    function getWeekOptions() {
      const today = new Date();
      const thisMonday = getMonday(today);
      const lastMonday = new Date(thisMonday); lastMonday.setDate(thisMonday.getDate() - 7);
      const nextMonday = new Date(thisMonday); nextMonday.setDate(thisMonday.getDate() + 7);
      return [
        {label: 'ä¸Šé€± ('+formatDate(lastMonday)+')', value: formatDate(lastMonday)},
        {label: 'æœ¬é€± ('+formatDate(thisMonday)+')', value: formatDate(thisMonday)},
        {label: 'ä¸‹é€± ('+formatDate(nextMonday)+')', value: formatDate(nextMonday)}
      ];
    }
    function getWeekDates(mondayStr) {
      // åš´æ ¼åªæ¥å— YYYY-MM-DD æ ¼å¼
      let monday = /^\d{4}-\d{2}-\d{2}$/.test(mondayStr) ? new Date(mondayStr) : null;
      if (!monday || isNaN(monday.getTime())) {
        // å¦‚æœç„¡æ•ˆï¼Œæ”¹ç”¨æœ¬é€±ä¸€
        monday = getMonday(new Date());
      }
      const days = ['(é€±ä¸€)','(é€±äºŒ)','(é€±ä¸‰)','(é€±å››)','(é€±äº”)'];
      return days.map((d, i) => {
        const date = new Date(monday);
        date.setDate(monday.getDate() + i);
        return `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()} ${d}`;
      });
    }
    function renderWeekSelect() {
      const weekSelect = document.getElementById('weekSelect');
      weekSelect.innerHTML = '';
      getWeekOptions().forEach(opt => {
        const option = document.createElement('option');
        option.value = opt.value;
        option.textContent = opt.label;
        weekSelect.appendChild(option);
      });
      let savedWeek = localStorage.getItem('selectedWeek');
      // åš´æ ¼æª¢æŸ¥æ ¼å¼
      if (!savedWeek || !/^\d{4}-\d{2}-\d{2}$/.test(savedWeek)) {
        savedWeek = getWeekOptions()[1].value; // é è¨­æœ¬é€±
        localStorage.setItem('selectedWeek', savedWeek);
      }
      weekSelect.value = savedWeek;
    }
    function getEmployeeList() {
      return JSON.parse(localStorage.getItem('employeeList') || 'null') || [
        {name: 'é¡å˜‰å®', tableId: 'table-yan'},
        {name: 'æˆ´èª å¿—', tableId: 'table-dai'},
        {name: 'é™³ç«‹', tableId: 'table-ou'}
      ];
    }
    function getTableKey(tableId) {
      const week = document.getElementById('weekSelect').value;
      return tableId + '-' + week;
    }
    function getDefaultDayData(dateStr) {
      return {
        date: dateStr,
        start: '',
        end: '',
        car: '',
        carStartKm: '',
        carEndKm: '',
        routes: [ {customer: '', content: ''} ]
      };
    }
    function getDefaultTableData(weekMonday) {
      const dates = getWeekDates(weekMonday);
      return dates.map(date => getDefaultDayData(date));
    }
    function loadTable(tableId) {
      const week = document.getElementById('weekSelect').value;
      const key = getTableKey(tableId);
      let data = JSON.parse(localStorage.getItem(key) || 'null');
      if (!data) data = getDefaultTableData(week);
      return data;
    }
    // å°ˆæ¥­æ©«å‘é€±è¡¨ç¸½è¦½
    function renderSummaryBlock() {
      const list = getEmployeeList();
      const weekDates = getWeekDates(document.getElementById('weekSelect').value);
      let html = '';
      
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        html += `<div class="pro-summary-employee">`;
        html += `<div class="pro-summary-title"><span class='icon'>ğŸ‘¤</span>${emp.name} çš„æœ¬é€±è¡Œç¨‹</div>`;
        html += `<table class="pro-summary-table"><thead><tr>`;
        weekDates.forEach(date => {
          html += `<th>${date}</th>`;
        });
        html += `</tr></thead><tbody><tr>`;
        weekData.forEach((day, dayIdx) => {
          html += `<td class="pro-summary-daycell">`;
          // è¡Œç¨‹
          if (day.routes && day.routes.length > 0 && day.routes.some(r => r.customer || r.content)) {
            html += `<div class="pro-summary-routes">`;
            day.routes.forEach((route, routeIdx) => {
              if (route.customer || route.content) {
                html += `<div class="pro-summary-route">`;
                // å®¢æˆ¶åç¨±
                html += `<div style='display:flex;align-items:center;gap:8px;flex-wrap:wrap;'>`;
                html += `<b>å®¢æˆ¶ï¼š</b>${route.customer || ''}`;
                html += `</div>`;
                // å…§å®¹ç¨ç«‹ä¸€è¡Œ
                if (route.content) html += `<div style='margin-top:4px;'><b>å…§å®¹ï¼š</b>${route.content}</div>`;
                // ç…§ç‰‡èˆ‡åœ°åœ–ï¼ˆåªä¿ç•™ç…§ç‰‡/åˆªé™¤åœ°åœ–é€£çµï¼‰
                if (route.photo) {
                  html += `<div style='margin:6px 0;display:flex;align-items:center;gap:8px;'>`;
                  html += `<img src='${route.photo}' alt='ç…§ç‰‡' style='max-width:80px;max-height:60px;cursor:pointer;border-radius:6px;border:1px solid #ccc;' onclick="showRoutePhotoModal('${encodeURIComponent(route.photo)}')">`;
                  html += `<button type='button' style='background:#dc3545;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:0.9em;' onclick="deleteRoutePhoto('${emp.tableId}',${dayIdx},${routeIdx})">åˆªé™¤</button>`;
                  html += `</div>`;
                }
                html += `</div>`;
              }
            });
            html += `</div>`;
          } else {
            html += `<div class="empty-day">ï¼ˆç„¡è¡Œç¨‹ï¼‰</div>`;
          }
          // meta
          let km = '';
          const carStart = day.carStartKm || '';
          const carEnd = day.carEndKm || '';
          if (carStart !== '' && carEnd !== '' && !isNaN(carStart) && !isNaN(carEnd)) {
            km = Number(carEnd) - Number(carStart);
            if (isNaN(km)) km = '';
          }
          // å°ˆæ¥­è¡¨æ ¼æ’ç‰ˆ - ç”¨åˆ†éš”ç·šéš”é–‹æ™‚é–“å’Œè»Šè¼›è³‡è¨Š
          html += `<div class="time-section">`;
          html += `<div class="time-header">â° å‡ºå‹¤æ™‚é–“</div>`;
          html += `<table class=\"pro-summary-meta-table\">`;
          html += `<tr><td>ğŸš— å‡ºå‹¤</td><td>${day.start || '-'}</td></tr>`;
          html += `<tr><td>ğŸ å›å…¬å¸</td><td>${day.end || '-'}</td></tr>`;
          html += `</table>`;
          html += `</div>`;
          
          // åˆ†éš”ç·š
          html += `<div class="meta-divider"></div>`;
          
          html += `<div class="vehicle-section">`;
          html += `<div class="vehicle-header">ğŸš— è»Šè¼›è³‡è¨Š</div>`;
          html += `<table class=\"pro-summary-meta-table\">`;
          html += `<tr><td>ğŸ”– è»Šç‰Œ</td><td>${day.car || '-'}</td></tr>`;
          html += `<tr><td>ğŸ“ å‡ºç™¼å…¬é‡Œæ•¸</td><td>${carStart || '-'}</td></tr>`;
          html += `<tr><td>ğŸ å›ä¾†å…¬é‡Œæ•¸</td><td>${carEnd || '-'}</td></tr>`;
          html += `<tr><td>âœï¸ å…¬é‡Œæ•¸</td><td>${km === '' ? '-' : km}</td></tr>`;
          html += `</table>`;
          html += `</div>`;
          if (day.refuel) {
            html += `<div class="pro-summary-refuel"><span class='icon'>â›½</span>å·²åŠ æ²¹`;
            if(day.refuelKm || day.refuelLiters) {
              html += `<span class='pro-summary-refuel-detail'>å…¬é‡Œæ•¸ï¼š${day.refuelKm || '-'}ï¼Œå…¬å‡ï¼š${day.refuelLiters || '-'}`;
              if(day.refuelAmount) {
                html += `ï¼Œé‡‘é¡ï¼š$${day.refuelAmount}`;
              }
              html += `</span>`;
            }
            html += `</div>`;
          } else {
            // æ·»åŠ åŠ æ²¹æŒ‰éˆ•
            html += `<div class="pro-summary-refuel-section">`;
            html += `<button type="button" class="refuel-btn" onclick="showRefuelModal('${emp.tableId}', ${dayIdx})">`;
            html += `<span class='icon'>â›½</span>ä»Šæ—¥åŠ æ²¹`;
            html += `</button>`;
            html += `</div>`;
          }
          html += `</td>`;
        });
        html += `</tr></tbody></table>`;
        // æ–°å¢æœ¬é€±ç¸½å…¬é‡Œæ•¸å’ŒåŠ æ²¹çµ±è¨ˆ
        let totalKm = 0;
        let totalRefuelLiters = 0;
        let totalRefuelAmount = 0;
        let refuelCount = 0;
        
        weekData.forEach(day => {
          const carStart = day.carStartKm || '';
          const carEnd = day.carEndKm || '';
          if (carStart !== '' && carEnd !== '' && !isNaN(carStart) && !isNaN(carEnd)) {
            const km = Number(carEnd) - Number(carStart);
            if (!isNaN(km)) totalKm += km;
          }
          
          // çµ±è¨ˆåŠ æ²¹è¨˜éŒ„
          if (day.refuel) {
            const liters = parseFloat(day.refuelLiters) || 0;
            const amount = parseFloat(day.refuelAmount) || 0;
            if (liters > 0) {
              totalRefuelLiters += liters;
              totalRefuelAmount += amount;
              refuelCount++;
            }
          }
        });
        
        html += `<div style='font-weight:700;color:#357abd;margin:12px 0 0 12px;'>æœ¬é€±ç¸½è¡Œé§›å…¬é‡Œæ•¸ï¼š${totalKm} km`;
        if (refuelCount > 0) {
          const avgKmPerLiter = totalRefuelLiters > 0 ? (totalKm / totalRefuelLiters).toFixed(1) : 0;
          const avgCostPerKm = totalKm > 0 ? (totalRefuelAmount / totalKm).toFixed(2) : 0;
          html += ` | åŠ æ²¹${refuelCount}æ¬¡ï¼Œç¸½${totalRefuelLiters}Lï¼Œå¹³å‡æ²¹è€—${avgKmPerLiter}km/Lï¼Œå¹³å‡æ¯å…¬é‡Œ$${avgCostPerKm}`;
        }
        html += `</div>`;
        html += `</div>`;
      });
      document.getElementById('summaryBlock').innerHTML = html;
    }
    document.addEventListener('DOMContentLoaded', function() {
      renderWeekSelect();
      renderSummaryBlock();
      document.getElementById('weekSelect').addEventListener('change', function() {
        localStorage.setItem('selectedWeek', this.value);
        renderSummaryBlock();
      });
      autoSetTheme();
      updateThemeIcon();
      // å…¬é‡Œæ•¸å½™æ•´æŒ‰éˆ•äº‹ä»¶å®‰å…¨ç¶å®š
      var btn = document.getElementById('mileageSummaryBtn');
      var modal = document.getElementById('mileageSummaryModal');
      var closeBtn = document.getElementById('closeMileageSummary');
      if(btn && modal && closeBtn) {
        btn.onclick = function() {
          renderMileageSummary();
          modal.style.display = 'flex';
        };
        closeBtn.onclick = function() {
          modal.style.display = 'none';
        };
        modal.onclick = function(e) {
          if (e.target === modal) modal.style.display = 'none';
        };
      }
      var exportBtn = document.getElementById('exportMileageExcel');
      if(exportBtn) {
        exportBtn.onclick = function() {
          // å–å¾—è¡¨æ ¼è³‡æ–™
          var table = document.getElementById('mileageSummaryTable').querySelector('table');
          if(!table) return;
          var wb = XLSX.utils.table_to_book(table, {sheet: "å…¬é‡Œæ•¸å½™æ•´"});
          XLSX.writeFile(wb, 'å…¬é‡Œæ•¸å½™æ•´.xlsx');
        }
      }
      // æŸ¥è©¢æŒ‰éˆ•äº‹ä»¶
      var queryBtn = document.getElementById('mileageQueryBtn');
      if(queryBtn) {
        queryBtn.onclick = function() {
          renderMileageSummary();
        }
      }
      // åˆæ¬¡è¼‰å…¥è‡ªå‹•æŸ¥è©¢
      renderMileageSummary();
      // å‹•æ…‹è¨­å®š active
      const path = location.pathname;
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      if (path.endsWith('index.html') || path.endsWith('/')) {
        document.getElementById('nav-personal').classList.add('active');
      } else if (path.endsWith('weekly-schedule-summary.html')) {
        document.getElementById('nav-summary').classList.add('active');
      }
      // åœ°é»çµ±è¨ˆæŒ‰éˆ•äº‹ä»¶
      var placeBtn = document.getElementById('placeSummaryBtn');
      var placeModal = document.getElementById('placeSummaryModal');
      var closePlaceBtn = document.getElementById('closePlaceSummary');
      if(placeBtn && placeModal && closePlaceBtn) {
        placeBtn.onclick = function() {
          // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
          document.getElementById('placeSummaryTable').innerHTML = 
            '<div style="text-align: center; color: #357abd; padding: 40px; font-weight: 600;">è¼‰å…¥åœ°é»çµ±è¨ˆä¸­...</div>';
          placeModal.style.display = 'flex';
          
          // å»¶é²ä¸€ä¸‹è®“è¼‰å…¥å‹•ç•«é¡¯ç¤ºï¼Œç„¶å¾ŒåŸ·è¡Œçµ±è¨ˆ
          setTimeout(() => {
            renderPlaceSummary();
          }, 100);
        };
        closePlaceBtn.onclick = function() {
          placeModal.style.display = 'none';
        };
        placeModal.onclick = function(e) {
          if (e.target === placeModal) placeModal.style.display = 'none';
        };
      }
      var exportPlaceBtn = document.getElementById('exportPlaceExcel');
      if(exportPlaceBtn) {
        exportPlaceBtn.onclick = function() {
          var table = document.getElementById('placeSummaryTable').querySelector('table');
          if(!table) return;
          var wb = XLSX.utils.table_to_book(table, {sheet: "åœ°é»çµ±è¨ˆ"});
          XLSX.writeFile(wb, 'åœ°é»çµ±è¨ˆ.xlsx');
        }
      }
      // åœ°é»çµ±è¨ˆé¡å‹åˆ‡æ›äº‹ä»¶
      document.querySelectorAll('input[name="placeSummaryType"]').forEach(radio => {
        radio.addEventListener('change', function() {
          renderPlaceSummary();
        });
      });
      
      // æ™ºèƒ½åˆ†ææŒ‰éˆ•äº‹ä»¶
      var analyticsBtn = document.getElementById('analyticsBtn');
      var analyticsModal = document.getElementById('analyticsModal');
      var closeAnalyticsBtn = document.getElementById('closeAnalytics');
      if(analyticsBtn && analyticsModal && closeAnalyticsBtn) {
        analyticsBtn.onclick = function() {
          renderAnalytics();
          analyticsModal.style.display = 'flex';
        };
        closeAnalyticsBtn.onclick = function() {
          analyticsModal.style.display = 'none';
        };
        analyticsModal.onclick = function(e) {
          if (e.target === analyticsModal) analyticsModal.style.display = 'none';
        };
      }
      
      var exportAnalyticsBtn = document.getElementById('exportAnalyticsExcel');
      if(exportAnalyticsBtn) {
        exportAnalyticsBtn.onclick = function() {
          exportAnalyticsReport();
        }
      }
      var exportMileageInlineBtn = document.getElementById('exportMileageInlineExcel');
      if(exportMileageInlineBtn) {
        exportMileageInlineBtn.onclick = function() {
          // ç›´æ¥è¤‡ç”¨ renderMileageSummary ç”¢ç”Ÿçš„è¡¨æ ¼
          var table = document.getElementById('mileageSummaryInline').querySelector('table');
          if(!table) return;
          var wb = XLSX.utils.table_to_book(table, {sheet: "å…¬é‡Œæ•¸å½™æ•´"});
          XLSX.writeFile(wb, 'å…¬é‡Œæ•¸å½™æ•´.xlsx');
        }
      }
      
      // åŠ æ²¹æ¨¡æ…‹æ¡†äº‹ä»¶ç¶å®š
      var refuelModal = document.getElementById('refuelModal');
      var closeRefuelBtn = document.getElementById('closeRefuelModal');
      var saveRefuelBtn = document.getElementById('saveRefuelBtn');
      
      if(refuelModal && closeRefuelBtn && saveRefuelBtn) {
        closeRefuelBtn.onclick = function() {
          refuelModal.style.display = 'none';
        };
        
        saveRefuelBtn.onclick = function() {
          saveRefuelRecord();
        };
        
        refuelModal.onclick = function(e) {
          if (e.target === refuelModal) refuelModal.style.display = 'none';
        };
        
        // åŠ æ²¹è¼¸å…¥æ¬„ä½å³æ™‚è¨ˆç®—
        document.getElementById('refuelKm').addEventListener('input', calculateRefuelStats);
        document.getElementById('refuelLiters').addEventListener('input', calculateRefuelStats);
        document.getElementById('refuelAmount').addEventListener('input', calculateRefuelStats);
      }
    });
    // ä¸»é¡Œåˆ‡æ›
    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('themeManual', '1');
      updateThemeIcon();
    }
    function updateThemeIcon() {
      var icon = document.getElementById('themeIcon');
      if (!icon) return;
      icon.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
    }
    // å–å¾—æœ¬æœˆæ‰€æœ‰é€±ä¸€æ—¥æœŸ
    function getAllMondaysOfMonth(year, month) {
      let mondays = [];
      let date = new Date(year, month, 1);
      // æ‰¾åˆ°ç¬¬ä¸€å€‹é€±ä¸€
      while (date.getDay() !== 1) { date.setDate(date.getDate() + 1); }
      while (date.getMonth() === month) {
        mondays.push(new Date(date));
        date.setDate(date.getDate() + 7);
      }
      return mondays;
    }
    // å–å¾—æœ¬æœˆæ‰€æœ‰æ—¥æœŸå­—ä¸²
    function getAllDatesOfMonth(year, month) {
      let dates = [];
      let date = new Date(year, month, 1);
      while (date.getMonth() === month) {
        dates.push(`${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}`);
        date.setDate(date.getDate() + 1);
      }
      return dates;
    }
    // --- ä¿®æ­£ç‰ˆ renderMileageSummary ---
    function renderMileageSummary() {
      try {
        const list = getEmployeeList();
        let start = document.getElementById('mileageStartDate').value;
        let end = document.getElementById('mileageEndDate').value;
        if (!start || !end) {
          const today = new Date();
          const year = today.getFullYear();
          const month = today.getMonth();
          start = `${year}-${String(month+1).padStart(2,'0')}-01`;
          const lastDay = new Date(year, month+1, 0).getDate();
          end = `${year}-${String(month+1).padStart(2,'0')}-${String(lastDay).padStart(2,'0')}`;
          document.getElementById('mileageStartDate').value = start;
          document.getElementById('mileageEndDate').value = end;
        }
        const startDate = new Date(start);
        const endDate = new Date(end);
        let rows = [];
        Object.keys(localStorage).forEach(key => {
          let raw = localStorage.getItem(key);
          let data;
          try {
            data = JSON.parse(raw);
          } catch(e) {
            return; // è·³éä¸åˆæ³•çš„ JSON
          }
          if (!Array.isArray(data)) return;
          let emp = null;
          for (const e of list) {
            if (key.startsWith(e.tableId + '-')) {
              emp = e;
              break;
            }
          }
          if (!emp) return;
          data.forEach(day => {
            if (!day || !day.date) return;
            let dayDate;
            let dateStr = day.date;
            let match = dateStr.match(/(\d{4})[\/-](\d{1,2})[\/-](\d{1,2})/);
            if (!match) {
              match = dateStr.match(/(\d{4})[\/-]?(\d{1,2})[\/-]?(\d{1,2})/);
            }
            if (match) {
              dayDate = new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
            } else {
              dayDate = new Date(dateStr);
            }
            if (isNaN(dayDate.getTime())) return;
            if (dayDate < startDate || dayDate > endDate) return;
            const carStart = day.carStartKm || '';
            const carEnd = day.carEndKm || '';
            let mileage = '';
            if (carStart !== '' && carEnd !== '' && !isNaN(carStart) && !isNaN(carEnd)) {
              mileage = Number(carEnd) - Number(carStart);
              if (isNaN(mileage)) mileage = '';
            }
            let refuelKm = day.refuel ? (day.refuelKm || '') : '';
            let refuelLiters = day.refuel ? (day.refuelLiters || '') : '';
            rows.push({
              emp: emp.name,
              date: day.date,
              carStart,
              carEnd,
              mileage,
              refuelKm,
              refuelLiters
            });
          });
        });
        let html = `<table class="modal-table">`;
        html += `<thead><tr><th>å“¡å·¥</th><th>æ—¥æœŸ</th><th>å‡ºç™¼å…¬é‡Œæ•¸</th><th>å›ä¾†å…¬é‡Œæ•¸</th><th>è¡Œé§›å…¬é‡Œæ•¸</th><th>åŠ æ²¹å…¬é‡Œæ•¸</th><th>åŠ æ²¹å…¬å‡æ•¸</th></tr></thead><tbody>`;
        rows.forEach(r => {
          html += `<tr>`;
          html += `<td>${r.emp}</td>`;
          html += `<td>${r.date}</td>`;
          html += `<td>${r.carStart}</td>`;
          html += `<td>${r.carEnd}</td>`;
          html += `<td>${r.mileage === '' ? '-' : r.mileage}</td>`;
          html += `<td>${r.refuelKm || ''}</td>`;
          html += `<td>${r.refuelLiters || ''}</td>`;
          html += `</tr>`;
        });
        html += `</tbody></table>`;
        document.getElementById('mileageSummaryTable').innerHTML = html;
      } catch(e) {
        alert('å…¬é‡Œæ•¸å½™æ•´ç™¼ç”ŸéŒ¯èª¤ï¼š' + e.message);
      }
    }
    // --- END ä¿®æ­£ç‰ˆ renderMileageSummary ---
    // åœ°é»çµ±è¨ˆåŠŸèƒ½
    function renderPlaceSummary() {
      try {
        const list = getEmployeeList();
        const summaryTypeElement = document.querySelector('input[name="placeSummaryType"]:checked');
        if (!summaryTypeElement) {
          console.error('æ‰¾ä¸åˆ°åœ°é»çµ±è¨ˆé¡å‹é¸æ“‡å™¨');
          return;
        }
        const summaryType = summaryTypeElement.value;
      
      if (summaryType === 'all') {
        // å…¨éƒ¨çµ±è¨ˆ
        let placeCount = {};
        // æœå°‹æ‰€æœ‰ localStorage å…§æ‰€æœ‰å“¡å·¥æ‰€æœ‰é€±çš„è³‡æ–™
        Object.keys(localStorage).forEach(key => {
          if (!/-\d{4}-\d{2}-\d{2}$/.test(key)) return; // åªæŠ“è¡Œç¨‹è³‡æ–™
          const data = JSON.parse(localStorage.getItem(key) || 'null');
          if (!Array.isArray(data)) return;
          data.forEach(day => {
            if (!day || !day.routes) return;
            day.routes.forEach(route => {
              const place = (route.customer || '').trim();
              if (place) {
                placeCount[place] = (placeCount[place] || 0) + 1;
              }
            });
          });
        });
        // æ’åº
        const sorted = Object.entries(placeCount).sort((a,b)=>b[1]-a[1]);
        let html = `<table class="modal-table"><thead><tr><th>åœ°é»ï¼ˆå®¢æˆ¶ï¼‰</th><th>å‡ºç¾æ¬¡æ•¸</th></tr></thead><tbody>`;
        sorted.forEach(([place, count]) => {
          html += `<tr><td>${place}</td><td>${count}</td></tr>`;
        });
        html += `</tbody></table>`;
        document.getElementById('placeSummaryTable').innerHTML = html;
      } else {
        // æ¯äººçµ±è¨ˆ
        let employeePlaceCount = {};
        // åˆå§‹åŒ–æ¯å€‹å“¡å·¥çš„åœ°é»çµ±è¨ˆ
        list.forEach(emp => {
          employeePlaceCount[emp.name] = {};
        });
        
        // æœå°‹æ‰€æœ‰ localStorage å…§æ‰€æœ‰å“¡å·¥æ‰€æœ‰é€±çš„è³‡æ–™
        Object.keys(localStorage).forEach(key => {
          if (!/-\d{4}-\d{2}-\d{2}$/.test(key)) return; // åªæŠ“è¡Œç¨‹è³‡æ–™
          // å¾ key æ‰¾å‡ºæ˜¯å“ªå€‹å“¡å·¥çš„è³‡æ–™
          const tableId = key.split('-')[0] + '-' + key.split('-')[1];
          const employee = list.find(emp => emp.tableId === tableId);
          if (!employee) return;
          
          const data = JSON.parse(localStorage.getItem(key) || 'null');
          if (!Array.isArray(data)) return;
          data.forEach(day => {
            if (!day || !day.routes) return;
            day.routes.forEach(route => {
              const place = (route.customer || '').trim();
              if (place) {
                if (!employeePlaceCount[employee.name][place]) {
                  employeePlaceCount[employee.name][place] = 0;
                }
                employeePlaceCount[employee.name][place]++;
              }
            });
          });
        });
        
        // ç”Ÿæˆè¡¨æ ¼
        let html = `<table class="modal-table"><thead><tr><th>å“¡å·¥</th><th>åœ°é»ï¼ˆå®¢æˆ¶ï¼‰</th><th>å‡ºç¾æ¬¡æ•¸</th></tr></thead><tbody>`;
        list.forEach(emp => {
          const places = employeePlaceCount[emp.name];
          const sortedPlaces = Object.entries(places).sort((a,b)=>b[1]-a[1]);
          if (sortedPlaces.length === 0) {
            html += `<tr><td>${emp.name}</td><td colspan="2">ï¼ˆç„¡è¡Œç¨‹è¨˜éŒ„ï¼‰</td></tr>`;
          } else {
            sortedPlaces.forEach(([place, count], index) => {
              html += `<tr>`;
              if (index === 0) {
                html += `<td rowspan="${sortedPlaces.length}">${emp.name}</td>`;
              }
              html += `<td>${place}</td><td>${count}</td></tr>`;
            });
          }
        });
        html += `</tbody></table>`;
        document.getElementById('placeSummaryTable').innerHTML = html;
      }
      } catch(e) {
        console.error('åœ°é»çµ±è¨ˆç™¼ç”ŸéŒ¯èª¤ï¼š', e);
        document.getElementById('placeSummaryTable').innerHTML = 
          '<div style="text-align: center; color: #666; padding: 40px;">è¼‰å…¥åœ°é»çµ±è¨ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢</div>';
      }
    }
    // æ™ºèƒ½åˆ†æåŠŸèƒ½
    function renderAnalytics() {
      // é¡¯ç¤ºè¼‰å…¥ä¸­
      document.querySelectorAll('.chart-container').forEach(container => {
        container.innerHTML = '<div class="loading">è¼‰å…¥åˆ†æä¸­...</div>';
        container.classList.add('loading');
      });
      
      // å»¶é²ä¸€ä¸‹è®“è¼‰å…¥å‹•ç•«é¡¯ç¤º
      setTimeout(() => {
        renderVisitRepairRatio();
        renderVisitCustomers();
        renderRepairCustomers();
        renderVisitRepairTrend();
        
        // ç§»é™¤è¼‰å…¥ç‹€æ…‹
        document.querySelectorAll('.chart-container').forEach(container => {
          container.classList.remove('loading');
        });
      }, 500);
    }
    
    // åˆ¤æ–·è¡Œç¨‹é¡å‹ï¼ˆæ‹œè¨ªæˆ–ç¶­ä¿®ï¼‰
    function getRouteType(content) {
      if (!content) return 'visit'; // é è¨­ç‚ºæ‹œè¨ª
      const contentLower = content.toLowerCase();
      
      // ç¶­ä¿®ç›¸é—œé—œéµå­—
      const repairKeywords = ['ç¶­ä¿®', 'ä¿®ç†', 'ä¿®å¾©', 'æ•…éšœ', 'å•é¡Œ', 'ç•°å¸¸', 'å£æ‰', 'ä¸èƒ½', 'ç„¡æ³•', 'æª¢æŸ¥', 'æª¢æ¸¬', 'ä¿é¤Š', 'ç¶­è­·', 'æ›´æ›'];
      
      // æª¢æŸ¥æ˜¯å¦åŒ…å«ç¶­ä¿®é—œéµå­—
      for (let keyword of repairKeywords) {
        if (contentLower.includes(keyword)) {
          console.log('ç¶­ä¿®å‘½ä¸­:', keyword, content);
          return 'repair';
        }
      }
      
      return 'visit'; // é è¨­ç‚ºæ‹œè¨ª
    }
    
    // æ¸²æŸ“æ‹œè¨ªç¶­ä¿®æ¯”ä¾‹
    function renderVisitRepairRatio() {
      const list = getEmployeeList();
      const currentWeek = document.getElementById('weekSelect').value;
      
      let visitCount = 0;
      let repairCount = 0;
      
      // çµ±è¨ˆæœ¬é€±æ‰€æœ‰è¡Œç¨‹
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        weekData.forEach(day => {
          if (!day || !day.routes) return;
          day.routes.forEach(route => {
            const customer = (route.customer || '').trim();
            const content = (route.content || '').trim();
            if (customer) {
              const type = getRouteType(content);
              if (type === 'visit') {
                visitCount++;
              } else {
                repairCount++;
              }
            }
          });
        });
      });
      
      const total = visitCount + repairCount;
      const visitPercentage = total > 0 ? Math.round((visitCount / total) * 100) : 0;
      const repairPercentage = total > 0 ? Math.round((repairCount / total) * 100) : 0;
      
      let html = '<div class="ratio-container">';
      html += `
        <div class="ratio-item visit">
          <div class="ratio-number">${visitCount}</div>
          <div class="ratio-label">æ‹œè¨ª</div>
          <div class="ratio-percentage">${visitPercentage}%</div>
        </div>
        <div class="ratio-item repair">
          <div class="ratio-number">${repairCount}</div>
          <div class="ratio-label">ç¶­ä¿®</div>
          <div class="ratio-percentage">${repairPercentage}%</div>
        </div>
      `;
      html += '</div>';
      
      if (total === 0) {
        html = '<div style="text-align: center; color: #666; padding: 40px;">æœ¬é€±å°šç„¡è¡Œç¨‹è¨˜éŒ„</div>';
      }
      
      document.getElementById('visitRepairRatioChart').innerHTML = html;
    }
    
    // æ¸²æŸ“æ‹œè¨ªå®¢æˆ¶æ’è¡Œ
    function renderVisitCustomers() {
      const list = getEmployeeList();
      const currentWeek = document.getElementById('weekSelect').value;
      
      let customerCount = {};
      
      // çµ±è¨ˆæœ¬é€±æ‹œè¨ªå®¢æˆ¶
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        weekData.forEach(day => {
          if (!day || !day.routes) return;
          day.routes.forEach(route => {
            const customer = (route.customer || '').trim();
            const content = (route.content || '').trim();
            if (customer && getRouteType(content) === 'visit') {
              customerCount[customer] = (customerCount[customer] || 0) + 1;
            }
          });
        });
      });
      
      // æ’åºä¸¦å–å‰5å
      const sorted = Object.entries(customerCount).sort((a,b)=>b[1]-a[1]).slice(0,5);
      const maxCount = sorted.length > 0 ? sorted[0][1] : 1;
      
      let html = '<div class="ranking-list">';
      sorted.forEach(([customer, count], index) => {
        const percentage = (count / maxCount) * 100;
        html += `
          <div class="ranking-item">
            <div class="ranking-rank">${index + 1}</div>
            <div class="ranking-info">
              <div class="ranking-name">${customer}<span class="category-tag visit">æ‹œè¨ª</span></div>
              <div class="ranking-count">æ‹œè¨ª ${count} æ¬¡</div>
            </div>
            <div class="ranking-bar">
              <div class="ranking-bar-fill" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
      
      if (sorted.length === 0) {
        html += '<div style="text-align: center; color: #666; padding: 40px;">æœ¬é€±å°šç„¡æ‹œè¨ªè¨˜éŒ„</div>';
      }
      
      html += '</div>';
      document.getElementById('visitCustomersChart').innerHTML = html;
    }
    
    // æ¸²æŸ“ç¶­ä¿®å®¢æˆ¶æ’è¡Œ
    function renderRepairCustomers() {
      const list = getEmployeeList();
      const currentWeek = document.getElementById('weekSelect').value;
      
      let customerCount = {};
      
      // çµ±è¨ˆæœ¬é€±ç¶­ä¿®å®¢æˆ¶
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        weekData.forEach(day => {
          if (!day || !day.routes) return;
          day.routes.forEach(route => {
            const customer = (route.customer || '').trim();
            const content = (route.content || '').trim();
            if (customer && getRouteType(content) === 'repair') {
              customerCount[customer] = (customerCount[customer] || 0) + 1;
            }
          });
        });
      });
      
      // æ’åºä¸¦å–å‰5å
      const sorted = Object.entries(customerCount).sort((a,b)=>b[1]-a[1]).slice(0,5);
      const maxCount = sorted.length > 0 ? sorted[0][1] : 1;
      
      let html = '<div class="ranking-list">';
      sorted.forEach(([customer, count], index) => {
        const percentage = (count / maxCount) * 100;
        html += `
          <div class="ranking-item">
            <div class="ranking-rank">${index + 1}</div>
            <div class="ranking-info">
              <div class="ranking-name">${customer}<span class="category-tag repair">ç¶­ä¿®</span></div>
              <div class="ranking-count">ç¶­ä¿® ${count} æ¬¡</div>
            </div>
            <div class="ranking-bar">
              <div class="ranking-bar-fill" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
      
      if (sorted.length === 0) {
        html += '<div style="text-align: center; color: #666; padding: 40px;">æœ¬é€±å°šç„¡ç¶­ä¿®è¨˜éŒ„</div>';
      }
      
      html += '</div>';
      document.getElementById('repairCustomersChart').innerHTML = html;
    }
    
    // æ¸²æŸ“æ‹œè¨ªç¶­ä¿®è¶¨å‹¢
    function renderVisitRepairTrend() {
      const list = getEmployeeList();
      
      // åˆ†ææœ€è¿‘4é€±çš„è¶¨å‹¢
      const today = new Date();
      const weeks = [];
      for (let i = 3; i >= 0; i--) {
        const weekStart = new Date(today);
        weekStart.setDate(today.getDate() - (today.getDay() + 6) % 7 - (i * 7));
        weeks.push(weekStart.toISOString().slice(0,10));
      }
      
      let weeklyVisitStats = [];
      let weeklyRepairStats = [];
      
      weeks.forEach(weekMonday => {
        let weekVisitTotal = 0;
        let weekRepairTotal = 0;
        
        list.forEach(emp => {
          const key = emp.tableId + '-' + weekMonday;
          const data = JSON.parse(localStorage.getItem(key) || 'null');
          if (Array.isArray(data)) {
            data.forEach(day => {
              if (day && day.routes) {
                day.routes.forEach(route => {
                  const customer = (route.customer || '').trim();
                  const content = (route.content || '').trim();
                  if (customer) {
                    const type = getRouteType(content);
                    if (type === 'visit') {
                      weekVisitTotal++;
                    } else {
                      weekRepairTotal++;
                    }
                  }
                });
              }
            });
          }
        });
        
        weeklyVisitStats.push(weekVisitTotal);
        weeklyRepairStats.push(weekRepairTotal);
      });
      
      // è¨ˆç®—è¶¨å‹¢è®ŠåŒ–
      const visitChange = weeklyVisitStats[3] - weeklyVisitStats[0];
      const repairChange = weeklyRepairStats[3] - weeklyRepairStats[0];
      
      let html = '<div style="text-align: center; padding: 20px;">';
      html += '<div style="margin-bottom: 20px; font-weight: 600; color: #357abd;">æœ€è¿‘4é€±è¶¨å‹¢æ¯”è¼ƒ</div>';
      
      // è¶¨å‹¢æ¯”è¼ƒ
      html += '<div class="trend-comparison">';
      html += `
        <div class="trend-item">
          <div class="trend-title">æ‹œè¨ªè¶¨å‹¢</div>
          <div class="trend-value">${weeklyVisitStats[3]}</div>
          <div class="trend-change ${visitChange > 0 ? 'positive' : visitChange < 0 ? 'negative' : 'neutral'}">
            ${visitChange > 0 ? '+' : ''}${visitChange} (vs ç¬¬1é€±)
          </div>
        </div>
        <div class="trend-item">
          <div class="trend-title">ç¶­ä¿®è¶¨å‹¢</div>
          <div class="trend-value">${weeklyRepairStats[3]}</div>
          <div class="trend-change ${repairChange > 0 ? 'positive' : repairChange < 0 ? 'negative' : 'neutral'}">
            ${repairChange > 0 ? '+' : ''}${repairChange} (vs ç¬¬1é€±)
          </div>
        </div>
      `;
      html += '</div>';
      
      // é€±åº¦è¶¨å‹¢åœ–
      html += '<div style="margin-top: 25px;">';
      const maxValue = Math.max(...weeklyVisitStats, ...weeklyRepairStats, 1);
      
      weeks.forEach((week, index) => {
        const visitPercentage = (weeklyVisitStats[index] / maxValue) * 100;
        const repairPercentage = (weeklyRepairStats[index] / maxValue) * 100;
        const weekLabel = `ç¬¬${index + 1}é€±`;
        
        html += `
          <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9em;">
              <span>${weekLabel}</span>
              <span>æ‹œè¨ª: ${weeklyVisitStats[index]} | ç¶­ä¿®: ${weeklyRepairStats[index]}</span>
            </div>
            <div style="display: flex; gap: 5px; height: 20px; border-radius: 10px; overflow: hidden;">
              <div style="background: linear-gradient(90deg, #4caf50, #66bb6a); height: 100%; width: ${visitPercentage}%; transition: width 0.8s ease;" title="æ‹œè¨ª: ${weeklyVisitStats[index]}"></div>
              <div style="background: linear-gradient(90deg, #ff9800, #ffb74d); height: 100%; width: ${repairPercentage}%; transition: width 0.8s ease;" title="ç¶­ä¿®: ${weeklyRepairStats[index]}"></div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      html += '</div>';
      document.getElementById('visitRepairTrendChart').innerHTML = html;
    }
    // åŒ¯å‡ºåˆ†æå ±å‘Š
    function exportAnalyticsReport() {
      const list = getEmployeeList();
      const currentWeek = document.getElementById('weekSelect').value;
      
      // æ”¶é›†åˆ†ææ•¸æ“š
      let reportData = [];
      
      // æ‹œè¨ªç¶­ä¿®æ¯”ä¾‹æ•¸æ“š
      let visitCount = 0;
      let repairCount = 0;
      let visitCustomers = {};
      let repairCustomers = {};
      
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        weekData.forEach(day => {
          if (!day || !day.routes) return;
          day.routes.forEach(route => {
            const customer = (route.customer || '').trim();
            const content = (route.content || '').trim();
            if (customer) {
              const type = getRouteType(content);
              if (type === 'visit') {
                visitCount++;
                visitCustomers[customer] = (visitCustomers[customer] || 0) + 1;
              } else {
                repairCount++;
                repairCustomers[customer] = (repairCustomers[customer] || 0) + 1;
              }
            }
          });
        });
      });
      
      const total = visitCount + repairCount;
      const visitPercentage = total > 0 ? Math.round((visitCount / total) * 100) : 0;
      const repairPercentage = total > 0 ? Math.round((repairCount / total) * 100) : 0;
      
      // æ‹œè¨ªç¶­ä¿®æ¯”ä¾‹
      reportData.push({
        'åˆ†æé …ç›®': 'æ‹œè¨ªç¶­ä¿®æ¯”ä¾‹',
        'æ‹œè¨ªæ¬¡æ•¸': visitCount,
        'ç¶­ä¿®æ¬¡æ•¸': repairCount,
        'æ‹œè¨ªæ¯”ä¾‹': visitPercentage + '%',
        'ç¶­ä¿®æ¯”ä¾‹': repairPercentage + '%',
        'ç¸½è¡Œç¨‹æ•¸': total
      });
      
      // æ‹œè¨ªå®¢æˆ¶æ’è¡Œ
      Object.entries(visitCustomers).sort((a,b)=>b[1]-a[1]).forEach(([customer, count], index) => {
        reportData.push({
          'åˆ†æé …ç›®': 'æ‹œè¨ªå®¢æˆ¶æ’è¡Œ',
          'æ’å': index + 1,
          'å®¢æˆ¶åç¨±': customer,
          'æ‹œè¨ªæ¬¡æ•¸': count
        });
      });
      
      // ç¶­ä¿®å®¢æˆ¶æ’è¡Œ
      Object.entries(repairCustomers).sort((a,b)=>b[1]-a[1]).forEach(([customer, count], index) => {
        reportData.push({
          'åˆ†æé …ç›®': 'ç¶­ä¿®å®¢æˆ¶æ’è¡Œ',
          'æ’å': index + 1,
          'å®¢æˆ¶åç¨±': customer,
          'ç¶­ä¿®æ¬¡æ•¸': count
        });
      });
      
      // å“¡å·¥å·¥ä½œé‡æ•¸æ“š
      list.forEach(emp => {
        const weekData = loadTable(emp.tableId);
        let totalRoutes = 0;
        let totalDays = 0;
        let empVisitCount = 0;
        let empRepairCount = 0;
        
        weekData.forEach(day => {
          if (!day || !day.routes) return;
          const dayRoutes = day.routes.filter(r => r.customer || r.content).length;
          if (dayRoutes > 0) {
            totalRoutes += dayRoutes;
            totalDays++;
          }
          
          day.routes.forEach(route => {
            const customer = (route.customer || '').trim();
            const content = (route.content || '').trim();
            if (customer) {
              const type = getRouteType(content);
              if (type === 'visit') {
                empVisitCount++;
              } else {
                empRepairCount++;
              }
            }
          });
        });
        
        reportData.push({
          'åˆ†æé …ç›®': 'å“¡å·¥å·¥ä½œé‡',
          'å“¡å·¥å§“å': emp.name,
          'ç¸½è¡Œç¨‹æ•¸': totalRoutes,
          'æ‹œè¨ªæ¬¡æ•¸': empVisitCount,
          'ç¶­ä¿®æ¬¡æ•¸': empRepairCount,
          'æœ‰è¡Œç¨‹å¤©æ•¸': totalDays,
          'æ—¥å‡è¡Œç¨‹': totalDays > 0 ? (totalRoutes / totalDays).toFixed(1) : 0
        });
      });
      
      // å‰µå»ºå·¥ä½œè¡¨
      const ws = XLSX.utils.json_to_sheet(reportData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "æ‹œè¨ªç¶­ä¿®åˆ†æå ±å‘Š");
      
      // ä¸‹è¼‰æª”æ¡ˆ
      const fileName = `æ‹œè¨ªç¶­ä¿®åˆ†æå ±å‘Š_${currentWeek}.xlsx`;
      XLSX.writeFile(wb, fileName);
    }
    // åœ¨ script å€å¡ŠåŠ  deleteRoutePhoto å‡½æ•¸
    function deleteRoutePhoto(tableId, dayIdx, routeIdx) {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç…§ç‰‡ï¼Ÿ')) return;
      const data = loadTable(tableId);
      if (!data[dayIdx].routes[routeIdx]) return;
      delete data[dayIdx].routes[routeIdx].photo;
      delete data[dayIdx].routes[routeIdx].lat;
      delete data[dayIdx].routes[routeIdx].lng;
      saveTable(tableId, data);
      renderSummaryBlock();
    }
    // æ–°å¢æ‹ç…§/ä¸Šå‚³åŠŸèƒ½
    window.onPhotoUpload = function(tableId, dayIdx, routeIdx, mode) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      if (mode === 'camera') {
        input.capture = 'environment';
      }
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) {
          alert('ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿï¼Œè«‹ç¢ºèªç€è¦½å™¨æ”¯æ´æ‹ç…§ä¸¦å·²é–‹å•Ÿç›¸æ©Ÿæ¬Šé™ï¼Œæˆ–æ”¹ç”¨ã€Œé¸æ“‡æª”æ¡ˆã€åŠŸèƒ½ã€‚');
          return;
        }
        const reader = new FileReader();
        reader.onload = function(evt) {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
              savePhotoAndLocation(tableId, dayIdx, routeIdx, evt.target.result, pos.coords.latitude, pos.coords.longitude);
            }, function() {
              savePhotoAndLocation(tableId, dayIdx, routeIdx, evt.target.result, null, null);
            });
          } else {
            savePhotoAndLocation(tableId, dayIdx, routeIdx, evt.target.result, null, null);
          }
        };
        reader.readAsDataURL(file);
      };
      input.click();
    };

    function savePhotoAndLocation(tableId, dayIdx, routeIdx, photoData, lat, lng) {
      const data = loadTable(tableId);
      if (!data[dayIdx].routes[routeIdx]) return;
      data[dayIdx].routes[routeIdx].photo = photoData;
      data[dayIdx].routes[routeIdx].lat = lat;
      data[dayIdx].routes[routeIdx].lng = lng;
      saveTable(tableId, data);
      renderSummaryBlock();
    }
    
    // æ–°å¢ç¼ºå°‘çš„ saveTable å‡½æ•¸
    function saveTable(tableId, data) {
      const key = getTableKey(tableId);
      localStorage.setItem(key, JSON.stringify(data));
    }
    
    // åŠ æ²¹æ¨¡æ…‹æ¡†ç›¸é—œè®Šæ•¸
    let currentRefuelTableId = '';
    let currentRefuelDayIdx = -1;
    
    // é¡¯ç¤ºåŠ æ²¹æ¨¡æ…‹æ¡†
    function showRefuelModal(tableId, dayIdx) {
      currentRefuelTableId = tableId;
      currentRefuelDayIdx = dayIdx;
      
      // æ¸…ç©ºè¼¸å…¥æ¬„ä½
      document.getElementById('refuelKm').value = '';
      document.getElementById('refuelLiters').value = '';
      document.getElementById('refuelAmount').value = '';
      document.getElementById('refuelStats').style.display = 'none';
      
      // é¡¯ç¤ºæ¨¡æ…‹æ¡†
      document.getElementById('refuelModal').style.display = 'flex';
    }
    
    // è¨ˆç®—æ²¹è€—çµ±è¨ˆ
    function calculateRefuelStats() {
      const refuelKm = parseFloat(document.getElementById('refuelKm').value) || 0;
      const refuelLiters = parseFloat(document.getElementById('refuelLiters').value) || 0;
      const refuelAmount = parseFloat(document.getElementById('refuelAmount').value) || 0;
      
      if (refuelKm > 0 && refuelLiters > 0) {
        const data = loadTable(currentRefuelTableId);
        let totalKm = 0;
        let totalLiters = 0;
        let totalAmount = 0;
        let refuelCount = 0;
        
        // è¨ˆç®—æœ¬é€±æ‰€æœ‰åŠ æ²¹è¨˜éŒ„
        data.forEach(day => {
          if (day.refuel) {
            const km = parseFloat(day.refuelKm) || 0;
            const liters = parseFloat(day.refuelLiters) || 0;
            const amount = parseFloat(day.refuelAmount) || 0;
            
            if (km > 0 && liters > 0) {
              totalKm += km;
              totalLiters += liters;
              totalAmount += amount;
              refuelCount++;
            }
          }
        });
        
        // åŠ ä¸Šæœ¬æ¬¡åŠ æ²¹
        totalKm += refuelKm;
        totalLiters += refuelLiters;
        totalAmount += refuelAmount;
        refuelCount++;
        
        // è¨ˆç®—å¹³å‡æ²¹è€—
        const avgKmPerLiter = totalLiters > 0 ? (totalKm / totalLiters).toFixed(1) : 0;
        const avgCostPerKm = totalKm > 0 ? (totalAmount / totalKm).toFixed(2) : 0;
        const avgCostPerLiter = totalLiters > 0 ? (totalAmount / totalLiters).toFixed(2) : 0;
        
        let statsHtml = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9em;">';
        statsHtml += `<div><strong>æœ¬é€±ç¸½å…¬é‡Œæ•¸ï¼š</strong>${totalKm} km</div>`;
        statsHtml += `<div><strong>æœ¬é€±ç¸½åŠ æ²¹é‡ï¼š</strong>${totalLiters} L</div>`;
        statsHtml += `<div><strong>æœ¬é€±ç¸½é‡‘é¡ï¼š</strong>$${totalAmount}</div>`;
        statsHtml += `<div><strong>åŠ æ²¹æ¬¡æ•¸ï¼š</strong>${refuelCount} æ¬¡</div>`;
        statsHtml += `<div><strong>å¹³å‡æ²¹è€—ï¼š</strong>${avgKmPerLiter} km/L</div>`;
        statsHtml += `<div><strong>å¹³å‡æ¯å…¬é‡Œæˆæœ¬ï¼š</strong>$${avgCostPerKm}</div>`;
        statsHtml += `<div><strong>å¹³å‡æ¯å…¬å‡æˆæœ¬ï¼š</strong>$${avgCostPerLiter}</div>`;
        statsHtml += `<div><strong>æœ¬æ¬¡åŠ æ²¹æ²¹è€—ï¼š</strong>${refuelLiters > 0 ? (refuelKm / refuelLiters).toFixed(1) : 0} km/L</div>`;
        statsHtml += '</div>';
        
        document.getElementById('refuelStatsContent').innerHTML = statsHtml;
        document.getElementById('refuelStats').style.display = 'block';
      } else {
        document.getElementById('refuelStats').style.display = 'none';
      }
    }
    
    // å„²å­˜åŠ æ²¹è¨˜éŒ„
    function saveRefuelRecord() {
      const refuelKm = document.getElementById('refuelKm').value;
      const refuelLiters = document.getElementById('refuelLiters').value;
      const refuelAmount = document.getElementById('refuelAmount').value;
      
      if (!refuelKm || !refuelLiters) {
        alert('è«‹è‡³å°‘è¼¸å…¥åŠ æ²¹å…¬é‡Œæ•¸å’Œå…¬å‡æ•¸');
        return;
      }
      
      const data = loadTable(currentRefuelTableId);
      if (data[currentRefuelDayIdx]) {
        data[currentRefuelDayIdx].refuel = true;
        data[currentRefuelDayIdx].refuelKm = refuelKm;
        data[currentRefuelDayIdx].refuelLiters = refuelLiters;
        data[currentRefuelDayIdx].refuelAmount = refuelAmount;
        
        saveTable(currentRefuelTableId, data);
        renderSummaryBlock();
        
        // é—œé–‰æ¨¡æ…‹æ¡†
        document.getElementById('refuelModal').style.display = 'none';
        
        alert('åŠ æ²¹è¨˜éŒ„å·²å„²å­˜ï¼');
      }
    }
    
    // æ–°å¢ç¼ºå°‘çš„ showRoutePhotoModal å‡½æ•¸
    function showRoutePhotoModal(photoUrl) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.8); z-index: 9999; display: flex; 
        align-items: center; justify-content: center;
      `;
      modal.innerHTML = `
        <div style="position: relative; max-width: 90%; max-height: 90%;">
          <img src="${decodeURIComponent(photoUrl)}" style="max-width: 100%; max-height: 100%; border-radius: 8px;">
          <button onclick="this.parentElement.parentElement.remove()" style="
            position: absolute; top: -40px; right: 0; background: #dc3545; color: white; 
            border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;
          ">é—œé–‰</button>
        </div>
      `;
      document.body.appendChild(modal);
      modal.onclick = function(e) {
        if (e.target === modal) modal.remove();
      };
    }
    // åœ¨ script å€å¡Šæœ€å¾ŒåŠ 
    setTimeout(function(){
      var trigger = document.getElementById('secretTrigger');
      if (!trigger) {
        trigger = document.createElement('div');
        trigger.id = 'secretTrigger';
        trigger.style = 'position:fixed;right:10px;bottom:10px;width:32px;height:32px;opacity:0.1;z-index:9999;cursor:pointer;';
        document.body.appendChild(trigger);
      }
      trigger.onclick = function() {
        const pwd = prompt('è«‹è¼¸å…¥å¯†ç¢¼ï¼š');
        if (pwd === '820123') {
          window.showZhiYan = true;
          renderSummaryBlock();
          setTimeout(function(){ window.showZhiYan = false; renderSummaryBlock(); }, 3*60*1000);
        } else {
          alert('å¯†ç¢¼éŒ¯èª¤');
        }
      };
    }, 500);

    function autoSetTheme() {
      if (localStorage.getItem('themeManual')) return;
      const now = new Date();
      const hour = now.getHours();
      if (hour >= 6 && hour < 18) {
        document.body.classList.remove('dark');
      } else {
        document.body.classList.add('dark');
      }
      updateThemeIcon();
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">
    <span id="themeIcon">ğŸŒ™</span> ä¸»é¡Œåˆ‡æ›
  </button>
  
  <div class="nav-bar">
    <a href="index.html" class="nav-link" id="nav-personal">ğŸ“ å¡«å¯«å€‹äººè¡Œç¨‹</a>
    <a href="weekly-schedule-summary.html" class="nav-link" id="nav-summary">ğŸ“Š æŸ¥çœ‹ç¸½è¦½</a>
  </div>
  
  <div class="container">
    <div class="header-section">
      <div class="title">
        <span class="icon">ğŸ“Š</span>
        æ¯é€±è¡Œç¨‹ç¸½è¦½
      </div>
      
      <div class="controls-section">
        <div class="week-select-group">
          <span class="week-label">é¸æ“‡é€±æ¬¡ï¼š</span>
          <select class="week-select" id="weekSelect"></select>
        </div>
        
        <div class="action-buttons">
          <button id="mileageSummaryBtn" class="btn btn-primary">
            <span>ğŸš—</span>
            å…¬é‡Œæ•¸å½™æ•´
          </button>
          <button id="placeSummaryBtn" class="btn btn-secondary">
            <span>ğŸ“</span>
            åœ°é»çµ±è¨ˆ
          </button>
          <button id="analyticsBtn" class="btn btn-success">
            <span>ğŸ“Š</span>
            æ™ºèƒ½åˆ†æ
          </button>
        </div>
      </div>
    </div>
    
    <div id="summaryBlock"></div>
  </div>
  
  <!-- å…¬é‡Œæ•¸å½™æ•´æ¨¡æ…‹æ¡† -->
  <div id="mileageSummaryModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closeMileageSummary" class="modal-close">âœ–</button>
      
      <div class="modal-title">
        <span>ğŸš—</span>
        å…¬é‡Œæ•¸å½™æ•´
      </div>
      
      <div class="modal-controls">
        <label>
          èµ·å§‹æ—¥æœŸ
          <input type="date" id="mileageStartDate">
        </label>
        <label>
          çµæŸæ—¥æœŸ
          <input type="date" id="mileageEndDate">
        </label>
        <button id="mileageQueryBtn" class="btn btn-primary">æŸ¥è©¢</button>
      </div>
      
      <div id="mileageSummaryTable"></div>
      
      <div class="modal-actions">
        <button id="exportMileageExcel" class="btn btn-success">
          <span>ğŸ“¥</span>
          åŒ¯å‡º Excel
        </button>
      </div>
    </div>
  </div>
  
  <!-- åœ°é»çµ±è¨ˆæ¨¡æ…‹æ¡† -->
  <div id="placeSummaryModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closePlaceSummary" class="modal-close">âœ–</button>
      <div class="modal-title">
        <span>ğŸ“</span>
        åœ°é»çµ±è¨ˆ
      </div>
      <div class="modal-controls">
        <label>
          <input type="radio" name="placeSummaryType" value="all" checked> å…¨éƒ¨çµ±è¨ˆ
        </label>
        <label>
          <input type="radio" name="placeSummaryType" value="byEmployee"> æ¯äººçµ±è¨ˆ
        </label>
      </div>
      <div id="placeSummaryTable"></div>
      <div class="modal-actions">
        <button id="exportPlaceExcel" class="btn btn-success">
          <span>ğŸ“¥</span>
          åŒ¯å‡º Excel
        </button>
      </div>
    </div>
  </div>
  
  <!-- åŠ æ²¹æ¨¡æ…‹æ¡† -->
  <div id="refuelModal" class="modal-overlay">
    <div class="modal-content">
      <button id="closeRefuelModal" class="modal-close">âœ–</button>
      
      <div class="modal-title">
        <span>â›½</span>
        ä»Šæ—¥åŠ æ²¹è¨˜éŒ„
      </div>
      
      <div class="modal-controls">
        <label>
          åŠ æ²¹å…¬é‡Œæ•¸
          <input type="number" id="refuelKm" placeholder="è«‹è¼¸å…¥åŠ æ²¹æ™‚çš„å…¬é‡Œæ•¸" min="0">
        </label>
        <label>
          åŠ æ²¹å…¬å‡æ•¸
          <input type="number" id="refuelLiters" placeholder="è«‹è¼¸å…¥åŠ æ²¹å…¬å‡æ•¸" min="0" step="0.1">
        </label>
        <label>
          åŠ æ²¹é‡‘é¡
          <input type="number" id="refuelAmount" placeholder="è«‹è¼¸å…¥åŠ æ²¹é‡‘é¡" min="0" step="1">
        </label>
      </div>
      
      <div id="refuelStats" style="margin: 20px 0; padding: 15px; background: rgba(53, 122, 189, 0.1); border-radius: 12px; display: none;">
        <h4 style="margin: 0 0 10px 0; color: #357abd;">ğŸ“Š æ²¹è€—çµ±è¨ˆ</h4>
        <div id="refuelStatsContent"></div>
      </div>
      
      <div class="modal-actions">
        <button id="saveRefuelBtn" class="btn btn-success">
          <span>ğŸ’¾</span>
          å„²å­˜åŠ æ²¹è¨˜éŒ„
        </button>
      </div>
    </div>
  </div>
  
  <!-- æ™ºèƒ½åˆ†ææ¨¡æ…‹æ¡† -->
  <div id="analyticsModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh;">
      <button id="closeAnalytics" class="modal-close">âœ–</button>
      <div class="modal-title">
        <span>ğŸ“Š</span>
        æ™ºèƒ½åˆ†æå„€è¡¨æ¿
      </div>
      
      <div class="analytics-grid">
        <!-- æ‹œè¨ªç¶­ä¿®æ¯”ä¾‹ -->
        <div class="analytics-card">
          <h3>ğŸ“Š æ‹œè¨ª vs ç¶­ä¿® æ¯”ä¾‹</h3>
          <div id="visitRepairRatioChart" class="chart-container"></div>
        </div>
        
        <!-- æ‹œè¨ªå®¢æˆ¶æ’è¡Œ -->
        <div class="analytics-card">
          <h3>ğŸ¯ æ‹œè¨ªå®¢æˆ¶æ’è¡Œ</h3>
          <div id="visitCustomersChart" class="chart-container"></div>
        </div>
        
        <!-- ç¶­ä¿®å®¢æˆ¶æ’è¡Œ -->
        <div class="analytics-card">
          <h3>ğŸ”§ ç¶­ä¿®å®¢æˆ¶æ’è¡Œ</h3>
          <div id="repairCustomersChart" class="chart-container"></div>
        </div>
        
        <!-- æ‹œè¨ªç¶­ä¿®è¶¨å‹¢ -->
        <div class="analytics-card">
          <h3>ğŸ“ˆ æ‹œè¨ª/ç¶­ä¿®è¶¨å‹¢</h3>
          <div id="visitRepairTrendChart" class="chart-container"></div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button id="exportAnalyticsExcel" class="btn btn-success">
          <span>ğŸ“¥</span>
          åŒ¯å‡ºåˆ†æå ±å‘Š
        </button>
      </div>
    </div>
  </div>
</body>
</html> 